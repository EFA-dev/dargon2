name: docbot

on:
 push:
   branches: [ main ]

jobs:
 test:

   runs-on: ubuntu-latest

   container:
     image:  google/dart:latest

   steps:
   - uses: actions/checkout@v2
   - name: Install dependencies
     run: pub get
   - name: Generate Documentation
     run: dartdoc
   - name: Push Documentation
     run: |
       mkdir doc-src && cd doc-src
       echo "docs.tmthecoder.dev" > CNAME
       git pull https://github.com/tmthecoder/docs --allow-unrelated--histories
       git config user.name  "Docbot"
       git config user.email "docbot@github.com"
       if [ -d dargon2/ ]; then rm -Rf dargon2/; fi
       cp -R ../doc/api dargon2/
       git remote add secure-origin https://${{ secrets.ACCESS_TOKEN }}@github.com/tmthecoder/docs
       git add .
       git commit -m "Updated documentation for dargon2"
       git push secure-origin main
